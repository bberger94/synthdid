<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>synthdid paper results • synthdid</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="synthdid paper results">
<meta property="og:description" content="synthdid">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">synthdid</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/synthdid.html">Get started</a>
</li>
<li>
  <a href="../articles/more-plotting.html">More on Plotting</a>
</li>
<li>
  <a href="../articles/paper-results.html">Paper results</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/synth-inference/synthdid">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="paper-results_files/header-attrs-2.13/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>synthdid paper results</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/synth-inference/synthdid/blob/master/vignettes/paper-results.Rmd"><code>vignettes/paper-results.Rmd</code></a></small>
      <div class="hidden name"><code>paper-results.Rmd</code></div>

    </div>

    
    

<style>
pre, pre code, .sourceCode {
  white-space: pre;
  overflow-x: scroll;
  width: 800px;
  max-width: 2400px;
}
</style>
<pre><code>## Installing packages into '/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpeoPsoA/temp_libpathb854d355ff0'
## (as 'lib' is unspecified)</code></pre>
<pre><code>## also installing the dependencies 'hms', 'prettyunits', 'listenv', 'parallelly', 'backports', 'base64url', 'brew', 'checkmate', 'data.table', 'progress', 'foreach', 'future', 'globals', 'iterators', 'batchtools'</code></pre>
<pre><code>## 
## The downloaded binary packages are in
##  /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpFSoiso/downloaded_packages</code></pre>
<pre><code>## Installing packages into '/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpeoPsoA/temp_libpathb854d355ff0'
## (as 'lib' is unspecified)</code></pre>
<pre><code>## also installing the dependencies 'credentials', 'zip', 'gitcreds', 'ini', 'clipr', 'gert', 'gh', 'xopen', 'commonmark', 'generics', 'tidyselect', 'usethis', 'pkgbuild', 'rcmdcheck', 'roxygen2', 'rversions', 'sessioninfo'</code></pre>
<pre><code>## 
## The downloaded binary packages are in
##  /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpFSoiso/downloaded_packages</code></pre>
<pre><code>## Downloading GitHub repo cran/glmnet@f4fc95ab49efaad9b6e1728a7c840bc6159501dc</code></pre>
<pre><code>## shape (NA -&gt; 1.4.6) [CRAN]</code></pre>
<pre><code>## Installing 1 packages: shape</code></pre>
<pre><code>## Installing package into '/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpeoPsoA/temp_libpathb854d355ff0'
## (as 'lib' is unspecified)</code></pre>
<pre><code>## 
## The downloaded binary packages are in
##  /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpFSoiso/downloaded_packages
## * checking for file ‘/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpFSoiso/remotesbee45f181e5/cran-glmnet-f4fc95a/DESCRIPTION’ ... OK
## * preparing ‘glmnet’:
## * checking DESCRIPTION meta-information ... OK
## * cleaning src
## * checking vignette meta-information ... OK
## * checking for LF line-endings in source and make files and shell scripts
## * checking for empty or unneeded directories
## * looking to see if a ‘data/datalist’ file should be added
## * building ‘glmnet_4.1-1.tar.gz’</code></pre>
<pre><code>## Installing package into '/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpeoPsoA/temp_libpathb854d355ff0'
## (as 'lib' is unspecified)</code></pre>
<pre><code>## Warning in i.p(...): installation of package '/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpFSoiso/filebee32845904/glmnet_4.1-1.tar.gz' had non-zero exit status</code></pre>
<pre><code>## Downloading GitHub repo susanathey/MCPanel@6b2706fd7c35f3266048ceb22a7e9a61ae1774da</code></pre>
<pre><code>## glmnet    (NA -&gt; 4.1-3) [CRAN]
## latex2exp (NA -&gt; 0.9.4) [CRAN]</code></pre>
<pre><code>## Installing 2 packages: glmnet, latex2exp</code></pre>
<pre><code>## Installing packages into '/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpeoPsoA/temp_libpathb854d355ff0'
## (as 'lib' is unspecified)</code></pre>
<pre><code>## 
## The downloaded binary packages are in
##  /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//RtmpFSoiso/downloaded_packages
## * checking for file ‘/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpFSoiso/remotesbeeafbc440/susanathey-MCPanel-6b2706f/DESCRIPTION’ ... OK
## * preparing ‘MCPanel’:
## * checking DESCRIPTION meta-information ... OK
## * cleaning src
## * excluding invalid files
## Subdirectory 'R' contains invalid file names:
##   ‘Makevars’
## * checking for LF line-endings in source and make files and shell scripts
## * checking for empty or unneeded directories
## Omitted ‘LazyData’ from DESCRIPTION
## * building ‘MCPanel_0.0.tar.gz’
## Warning in utils::tar(filepath, pkgname, compression = compression, compression_level = 9L,  :
##   storing paths of more than 100 bytes is not portable:
##   ‘MCPanel/tests/examples_from_paper/california/california_data_N_38_T_31_numruns_10_num_treated_35_simultaneuous_0.png’
## Warning in utils::tar(filepath, pkgname, compression = compression, compression_level = 9L,  :
##   storing paths of more than 100 bytes is not portable:
##   ‘MCPanel/tests/examples_from_paper/california/california_data_N_38_T_31_numruns_10_num_treated_35_simultaneuous_0.rds’
## Warning in utils::tar(filepath, pkgname, compression = compression, compression_level = 9L,  :
##   storing paths of more than 100 bytes is not portable:
##   ‘MCPanel/tests/examples_from_paper/california/california_data_N_38_T_31_numruns_10_num_treated_8_simultaneuous_1.png’
## Warning in utils::tar(filepath, pkgname, compression = compression, compression_level = 9L,  :
##   storing paths of more than 100 bytes is not portable:
##   ‘MCPanel/tests/examples_from_paper/california/california_data_N_38_T_31_numruns_10_num_treated_8_simultaneuous_1.rds’
## Warning in utils::tar(filepath, pkgname, compression = compression, compression_level = 9L,  :
##   storing paths of more than 100 bytes is not portable:
##   ‘MCPanel/tests/examples_from_paper/stock/stock_data_N_1000_T_5_numruns_5_num_treated_500_simultaneuous_0.png’
## Warning in utils::tar(filepath, pkgname, compression = compression, compression_level = 9L,  :
##   storing paths of more than 100 bytes is not portable:
##   ‘MCPanel/tests/examples_from_paper/stock/stock_data_N_1000_T_5_numruns_5_num_treated_500_simultaneuous_0.rds’
## Warning in utils::tar(filepath, pkgname, compression = compression, compression_level = 9L,  :
##   storing paths of more than 100 bytes is not portable:
##   ‘MCPanel/tests/examples_from_paper/stock/stock_data_N_5_T_1000_numruns_20_num_treated_3_simultaneuous_0.png’
## Warning in utils::tar(filepath, pkgname, compression = compression, compression_level = 9L,  :
##   storing paths of more than 100 bytes is not portable:
##   ‘MCPanel/tests/examples_from_paper/stock/stock_data_N_5_T_1000_numruns_20_num_treated_3_simultaneuous_0.rds’
## Warning in utils::tar(filepath, pkgname, compression = compression, compression_level = 9L,  :
##   storing paths of more than 100 bytes is not portable:
##   ‘MCPanel/tests/examples_from_paper/stock/stock_data_N_70_T_70_numruns_5_num_treated_35_simultaneuous_0.png’
## Warning in utils::tar(filepath, pkgname, compression = compression, compression_level = 9L,  :
##   storing paths of more than 100 bytes is not portable:
##   ‘MCPanel/tests/examples_from_paper/stock/stock_data_N_70_T_70_numruns_5_num_treated_35_simultaneuous_0.rds’</code></pre>
<pre><code>## Installing package into '/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/RtmpeoPsoA/temp_libpathb854d355ff0'
## (as 'lib' is unspecified)</code></pre>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">synthdid</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">MCPanel</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rngtools</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">future</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">doFuture</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">future.batchtools</span>)</pre></body></html></div>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">xtable</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)</pre></body></html></div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>In this vignette, we generate the figures and tables from <a href="https://arxiv.org/abs/1812.09970">Arkhangelsky et al.</a>. The
first section, on the California Proposition 99 application, generates
Table 1 and Figure 1. The second section runs the placebo simulations
discussed in Section 3 and then summarizes them by generating Tables 2-4
and Figure 2.</p>
</div>
<div id="the-estimators-considered" class="section level2">
<h2 class="hasAnchor">
<a href="#the-estimators-considered" class="anchor"></a>The estimators considered</h2>
<ul>
<li>sdid: synthetic diff-in-diff</li>
<li>sc : synthetic control</li>
<li>did: diff-in-diff</li>
<li>mc: the matrix completion estimator of <a href="https://arxiv.org/abs/1710.10251">Athey et al.</a>
</li>
<li>difp: de-meaned synthetic control, as proposed in <a href="https://arxiv.org/abs/1610.07748https://arxiv.org/abs/1610.07748">Doudchenko
and Imbens</a> and <a href="https://arxiv.org/abs/1911.08521">Ferman and
Pinto</a>.</li>
</ul>
<p>We also include variants sc_reg and difp_reg which, like sdid, use a
ridge penalty when estimating the synthetic control weights <span class="math inline">\(\omega\)</span>. These use the same
regularization-strength parameter <span class="math inline">\(\zeta\)</span> as sdid, defined in Algorithm 1 of
<a href="https://arxiv.org/abs/1812.09970">Arkhangelsky et al.</a></p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">mc_estimate</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">Y</span>, <span class="no">N0</span>, <span class="no">T0</span>) {
    <span class="no">N1</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Y</span>)-<span class="no">N0</span>
    <span class="no">T1</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">Y</span>)-<span class="no">T0</span>
    <span class="no">W</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>,<span class="no">N0</span>),<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>,<span class="no">N1</span>)),<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>,<span class="no">T0</span>),<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>,<span class="no">T1</span>)))
    <span class="no">mc_pred</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MCPanel/man/mcnnm_cv.html">mcnnm_cv</a></span>(<span class="no">Y</span>, <span class="fl">1</span>-<span class="no">W</span>, <span class="kw">num_lam_L</span> <span class="kw">=</span> <span class="fl">20</span>)
    <span class="no">mc_fit</span>  <span class="kw">&lt;-</span> <span class="no">mc_pred</span>$<span class="no">L</span> + <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span>(<span class="no">mc_pred</span>$<span class="no">u</span>, <span class="no">mc_pred</span>$<span class="no">v</span>, <span class="st">'+'</span>)
    <span class="no">mc_est</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">W</span>*(<span class="no">Y</span>-<span class="no">mc_fit</span>))/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">W</span>)
    <span class="no">mc_est</span>
}
<span class="no">mc_placebo_se</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">Y</span>, <span class="no">N0</span>, <span class="no">T0</span>, <span class="no">replications</span><span class="kw">=</span><span class="fl">200</span>) {
    <span class="no">N1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Y</span>) - <span class="no">N0</span>
    <span class="no">theta</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">ind</span>) { <span class="fu">mc_estimate</span>(<span class="no">Y</span>[<span class="no">ind</span>,], <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ind</span>)-<span class="no">N1</span>, <span class="no">T0</span>) }
    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>((<span class="no">replications</span>-<span class="fl">1</span>)/<span class="no">replications</span>) * <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span>(<span class="no">replications</span>, <span class="fu">theta</span>(<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span>:<span class="no">N0</span>))))
}

<span class="no">difp_estimate</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">Y</span>, <span class="no">N0</span>, <span class="no">T0</span>) {
    <span class="fu"><a href="../reference/synthdid_estimate.html">synthdid_estimate</a></span>(<span class="no">Y</span>, <span class="no">N0</span>, <span class="no">T0</span>, <span class="kw">weights</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lambda</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>/<span class="no">T0</span>, <span class="no">T0</span>)), <span class="kw">eta.omega</span><span class="kw">=</span><span class="fl">1e-6</span>)
}

<span class="no">sc_estimate_reg</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">Y</span>, <span class="no">N0</span>, <span class="no">T0</span>) {
    <span class="fu"><a href="../reference/sc_estimate.html">sc_estimate</a></span>(<span class="no">Y</span>, <span class="no">N0</span>, <span class="no">T0</span>, <span class="kw">eta.omega</span><span class="kw">=</span>((<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Y</span>)-<span class="no">N0</span>)*(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">Y</span>)-<span class="no">T0</span>))^(<span class="fl">1</span>/<span class="fl">4</span>))
}
<span class="no">difp_estimate_reg</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">Y</span>, <span class="no">N0</span>, <span class="no">T0</span>) {
    <span class="fu"><a href="../reference/synthdid_estimate.html">synthdid_estimate</a></span>(<span class="no">Y</span>, <span class="no">N0</span>, <span class="no">T0</span>, <span class="kw">weights</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">lambda</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>/<span class="no">T0</span>, <span class="no">T0</span>)))
}


<span class="no">estimators</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">did</span><span class="kw">=</span><span class="no">did_estimate</span>,
                  <span class="kw">sc</span><span class="kw">=</span><span class="no">sc_estimate</span>,
                  <span class="kw">sdid</span><span class="kw">=</span><span class="no">synthdid_estimate</span>,
                  <span class="kw">difp</span><span class="kw">=</span><span class="no">difp_estimate</span>,
                  <span class="kw">mc</span> <span class="kw">=</span> <span class="no">mc_estimate</span>,
                  <span class="kw">sc_reg</span> <span class="kw">=</span> <span class="no">sc_estimate_reg</span>,
                  <span class="kw">difp_reg</span> <span class="kw">=</span> <span class="no">difp_estimate_reg</span>)</pre></body></html></div>
</div>
<div id="california-proposition-99-application" class="section level1">
<h1 class="hasAnchor">
<a href="#california-proposition-99-application" class="anchor"></a>California Proposition 99 Application</h1>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">'california_prop99'</span>)
<span class="no">setup</span> <span class="kw">=</span> <span class="fu"><a href="../reference/panel.matrices.html">panel.matrices</a></span>(<span class="no">california_prop99</span>)

<span class="no">estimates</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">estimators</span>, <span class="kw">function</span>(<span class="no">estimator</span>) { <span class="fu">estimator</span>(<span class="no">setup</span>$<span class="no">Y</span>, <span class="no">setup</span>$<span class="no">N0</span>, <span class="no">setup</span>$<span class="no">T0</span>) } )
<span class="no">standard.errors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span>(<span class="kw">function</span>(<span class="no">estimate</span>, <span class="no">name</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">12345</span>)
  <span class="kw">if</span>(<span class="no">name</span> <span class="kw">==</span> <span class="st">'mc'</span>) { <span class="fu">mc_placebo_se</span>(<span class="no">setup</span>$<span class="no">Y</span>, <span class="no">setup</span>$<span class="no">N0</span>, <span class="no">setup</span>$<span class="no">T0</span>) }
  <span class="kw">else</span> {             <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span>(<span class="no">estimate</span>, <span class="kw">method</span><span class="kw">=</span><span class="st">'placebo'</span>))     }
}, <span class="no">estimates</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">estimators</span>))</pre></body></html></div>
<div id="table-1" class="section level2">
<h2 class="hasAnchor">
<a href="#table-1" class="anchor"></a>Table 1</h2>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">california.table</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">estimates</span>), <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">standard.errors</span>))
<span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span>(<span class="no">california.table</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'estimate'</span>, <span class="st">'standard error'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">california.table</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">estimators</span>))

<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">california.table</span>, <span class="kw">digits</span><span class="kw">=</span><span class="fl">1</span>)</pre></body></html></div>
<pre><code>##                  DID    SC  SDID  DIFP    MC SC_REG DIFP_REG
## estimate       -27.3 -19.6 -15.6 -11.1 -20.2  -21.7    -16.1
## standard error  17.7   9.9   8.4   9.5  11.5   10.0      9.2</code></pre>
</div>
<div id="figure-1--columns-are-did-sc-sdid-in-that-order-" class="section level2">
<h2 class="hasAnchor">
<a href="#figure-1--columns-are-did-sc-sdid-in-that-order-" class="anchor"></a>Figure 1. Columns are DID, SC, SDID in that order.</h2>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="../reference/synthdid_plot.html">synthdid_plot</a></span>(<span class="no">estimates</span>[<span class="fl">1</span>:<span class="fl">3</span>], <span class="kw">facet.vertical</span><span class="kw">=</span><span class="fl">FALSE</span>,
              <span class="kw">control.name</span><span class="kw">=</span><span class="st">'control'</span>, <span class="kw">treated.name</span><span class="kw">=</span><span class="st">'california'</span>,
              <span class="kw">lambda.comparable</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">se.method</span> <span class="kw">=</span> <span class="st">'none'</span>,
              <span class="kw">trajectory.linetype</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">line.width</span><span class="kw">=</span><span class="fl">.75</span>, <span class="kw">effect.curvature</span><span class="kw">=</span>-<span class="fl">.4</span>,
              <span class="kw">trajectory.alpha</span><span class="kw">=</span><span class="fl">.7</span>, <span class="kw">effect.alpha</span><span class="kw">=</span><span class="fl">.7</span>,
              <span class="kw">diagram.alpha</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">onset.alpha</span><span class="kw">=</span><span class="fl">.7</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.26</span>,<span class="fl">.07</span>), <span class="kw">legend.direction</span><span class="kw">=</span><span class="st">'horizontal'</span>,
          <span class="kw">legend.key</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(), <span class="kw">legend.background</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
          <span class="kw">strip.background</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(), <span class="kw">strip.text.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>())</pre></body></html></div>
<p><img src="figures/california-trends-plot-1.png" width="1440"></p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="../reference/synthdid_units_plot.html">synthdid_units_plot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">estimates</span>[<span class="fl">1</span>:<span class="fl">3</span>]), <span class="kw">se.method</span><span class="kw">=</span><span class="st">'none'</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.background</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(), <span class="kw">legend.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
          <span class="kw">legend.direction</span><span class="kw">=</span><span class="st">'horizontal'</span>, <span class="kw">legend.position</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.17</span>,<span class="fl">.07</span>),
          <span class="kw">strip.background</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(), <span class="kw">strip.text.x</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>())</pre></body></html></div>
<p><img src="figures/california-units-plot-1.png" width="1440"></p>
<div id="table-7-and-8-unit-and-time-weights" class="section level3">
<h3 class="hasAnchor">
<a href="#table-7-and-8-unit-and-time-weights" class="anchor"></a>Table 7 and 8: Unit and Time weights</h3>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">unit.weights</span> <span class="kw">=</span> <span class="fu"><a href="../reference/synthdid_controls.html">synthdid_controls</a></span>(<span class="no">estimates</span>[<span class="fl">1</span>:<span class="fl">3</span>], <span class="kw">weight.type</span><span class="kw">=</span><span class="st">'omega'</span>, <span class="kw">mass</span><span class="kw">=</span><span class="fl">1</span>)
<span class="no">time.weights</span> <span class="kw">=</span> <span class="fu"><a href="../reference/synthdid_controls.html">synthdid_controls</a></span>(<span class="no">estimates</span>[<span class="fl">1</span>:<span class="fl">3</span>], <span class="kw">weight.type</span><span class="kw">=</span><span class="st">'lambda'</span>, <span class="kw">mass</span><span class="kw">=</span><span class="fl">1</span>)

<span class="no">unit.table</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/xtable/man/xtable.html">xtable</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">unit.weights</span>[<span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">unit.weights</span>)), ], <span class="fl">3</span>))
<span class="no">time.table</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/xtable/man/xtable.html">xtable</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">time.weights</span>, <span class="fl">3</span>))

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">unit.table</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">'latex'</span>, <span class="kw">file</span><span class="kw">=</span><span class="st">'figures/table-california-unit-weights.tex'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">time.table</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">'latex'</span>, <span class="kw">file</span><span class="kw">=</span><span class="st">'figures/table-california-time-weights.tex'</span>)

<span class="no">unit.table</span></pre></body></html></div>
<pre><code>## % latex table generated in R 4.1.3 by xtable 1.8-4 package
## % Tue Mar 15 21:08:53 2022
## \begin{table}[ht]
## \centering
## \begin{tabular}{rrrr}
##   \hline
##  &amp; did &amp; sc &amp; sdid \\ 
##   \hline
## Alabama &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Arkansas &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Colorado &amp; 0.03 &amp; 0.01 &amp; 0.06 \\ 
##   Connecticut &amp; 0.03 &amp; 0.10 &amp; 0.08 \\ 
##   Delaware &amp; 0.03 &amp; 0.00 &amp; 0.07 \\ 
##   Georgia &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Idaho &amp; 0.03 &amp; 0.00 &amp; 0.03 \\ 
##   Illinois &amp; 0.03 &amp; 0.00 &amp; 0.05 \\ 
##   Indiana &amp; 0.03 &amp; 0.00 &amp; 0.01 \\ 
##   Iowa &amp; 0.03 &amp; 0.00 &amp; 0.03 \\ 
##   Kansas &amp; 0.03 &amp; 0.00 &amp; 0.02 \\ 
##   Kentucky &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Louisiana &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Maine &amp; 0.03 &amp; 0.00 &amp; 0.03 \\ 
##   Minnesota &amp; 0.03 &amp; 0.00 &amp; 0.04 \\ 
##   Mississippi &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Missouri &amp; 0.03 &amp; 0.00 &amp; 0.01 \\ 
##   Montana &amp; 0.03 &amp; 0.23 &amp; 0.04 \\ 
##   Nebraska &amp; 0.03 &amp; 0.00 &amp; 0.05 \\ 
##   Nevada &amp; 0.03 &amp; 0.20 &amp; 0.12 \\ 
##   New Hampshire &amp; 0.03 &amp; 0.04 &amp; 0.10 \\ 
##   New Mexico &amp; 0.03 &amp; 0.00 &amp; 0.04 \\ 
##   North Carolina &amp; 0.03 &amp; 0.00 &amp; 0.03 \\ 
##   North Dakota &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Ohio &amp; 0.03 &amp; 0.00 &amp; 0.03 \\ 
##   Oklahoma &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Pennsylvania &amp; 0.03 &amp; 0.00 &amp; 0.01 \\ 
##   Rhode Island &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   South Carolina &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   South Dakota &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Tennessee &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Texas &amp; 0.03 &amp; 0.00 &amp; 0.01 \\ 
##   Utah &amp; 0.03 &amp; 0.40 &amp; 0.04 \\ 
##   Vermont &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   Virginia &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##   West Virginia &amp; 0.03 &amp; 0.00 &amp; 0.03 \\ 
##   Wisconsin &amp; 0.03 &amp; 0.00 &amp; 0.04 \\ 
##   Wyoming &amp; 0.03 &amp; 0.00 &amp; 0.00 \\ 
##    \hline
## \end{tabular}
## \end{table}</code></pre>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">time.table</span></pre></body></html></div>
<pre><code>## % latex table generated in R 4.1.3 by xtable 1.8-4 package
## % Tue Mar 15 21:08:53 2022
## \begin{table}[ht]
## \centering
## \begin{tabular}{rrrr}
##   \hline
##  &amp; did &amp; sc &amp; sdid \\ 
##   \hline
## 1988 &amp; 0.05 &amp; 0.00 &amp; 0.43 \\ 
##   1987 &amp; 0.05 &amp; 0.00 &amp; 0.21 \\ 
##   1986 &amp; 0.05 &amp; 0.00 &amp; 0.37 \\ 
##   1985 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1984 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1983 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1982 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1981 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1980 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1979 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1978 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1977 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1976 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1975 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1974 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1973 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1972 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1971 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##   1970 &amp; 0.05 &amp; 0.00 &amp; 0.00 \\ 
##    \hline
## \end{tabular}
## \end{table}</code></pre>
</div>
</div>
</div>
<div id="placebo-simulations" class="section level1">
<h1 class="hasAnchor">
<a href="#placebo-simulations" class="anchor"></a>Placebo Simulations</h1>
<div id="load-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data" class="anchor"></a>load data</h2>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">last.col</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">X</span>) { <span class="no">X</span>[, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">X</span>)] }

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">CPS</span>)
<span class="no">Y.logwage</span>      <span class="kw">=</span> <span class="fu"><a href="../reference/panel.matrices.html">panel.matrices</a></span>(<span class="no">CPS</span>, <span class="kw">treatment</span><span class="kw">=</span><span class="st">'min_wage'</span>, <span class="kw">outcome</span><span class="kw">=</span><span class="st">'log_wage'</span>, <span class="kw">treated.last</span><span class="kw">=</span><span class="fl">FALSE</span>)$<span class="no">Y</span>
<span class="no">Y.hours</span>        <span class="kw">=</span> <span class="fu"><a href="../reference/panel.matrices.html">panel.matrices</a></span>(<span class="no">CPS</span>, <span class="kw">treatment</span><span class="kw">=</span><span class="st">'min_wage'</span>, <span class="kw">outcome</span><span class="kw">=</span><span class="st">'hours'</span>,    <span class="kw">treated.last</span><span class="kw">=</span><span class="fl">FALSE</span>)$<span class="no">Y</span>
<span class="no">Y.urate</span>        <span class="kw">=</span> <span class="fu"><a href="../reference/panel.matrices.html">panel.matrices</a></span>(<span class="no">CPS</span>, <span class="kw">treatment</span><span class="kw">=</span><span class="st">'min_wage'</span>, <span class="kw">outcome</span><span class="kw">=</span><span class="st">'urate'</span>,    <span class="kw">treated.last</span><span class="kw">=</span><span class="fl">FALSE</span>)$<span class="no">Y</span>
<span class="no">w.minwage</span>      <span class="kw">=</span> <span class="fu">last.col</span>(<span class="fu"><a href="../reference/panel.matrices.html">panel.matrices</a></span>(<span class="no">CPS</span>, <span class="kw">treatment</span><span class="kw">=</span><span class="st">'min_wage'</span>,   <span class="kw">treated.last</span><span class="kw">=</span><span class="fl">FALSE</span>)$<span class="no">W</span>)
<span class="no">w.gunlaw</span>       <span class="kw">=</span> <span class="fu">last.col</span>(<span class="fu"><a href="../reference/panel.matrices.html">panel.matrices</a></span>(<span class="no">CPS</span>, <span class="kw">treatment</span><span class="kw">=</span><span class="st">'open_carry'</span>, <span class="kw">treated.last</span><span class="kw">=</span><span class="fl">FALSE</span>)$<span class="no">W</span>)
<span class="no">w.abortion</span>     <span class="kw">=</span> <span class="fu">last.col</span>(<span class="fu"><a href="../reference/panel.matrices.html">panel.matrices</a></span>(<span class="no">CPS</span>, <span class="kw">treatment</span><span class="kw">=</span><span class="st">'abort_ban'</span>,  <span class="kw">treated.last</span><span class="kw">=</span><span class="fl">FALSE</span>)$<span class="no">W</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">PENN</span>)
<span class="no">Y.loggdp</span>       <span class="kw">=</span> <span class="fu"><a href="../reference/panel.matrices.html">panel.matrices</a></span>(<span class="no">PENN</span>, <span class="kw">treatment</span><span class="kw">=</span><span class="st">'dem'</span>, <span class="kw">outcome</span><span class="kw">=</span><span class="st">'log_gdp'</span>, <span class="kw">treated.last</span><span class="kw">=</span><span class="fl">FALSE</span>)$<span class="no">Y</span>
<span class="no">w.democracy</span>    <span class="kw">=</span> <span class="fu">last.col</span>(<span class="fu"><a href="../reference/panel.matrices.html">panel.matrices</a></span>(<span class="no">PENN</span>, <span class="kw">treatment</span><span class="kw">=</span><span class="st">'dem'</span>,  <span class="kw">treated.last</span><span class="kw">=</span><span class="fl">FALSE</span>)$<span class="no">W</span>)
<span class="no">w.education</span>    <span class="kw">=</span> <span class="fu">last.col</span>(<span class="fu"><a href="../reference/panel.matrices.html">panel.matrices</a></span>(<span class="no">PENN</span>, <span class="kw">treatment</span><span class="kw">=</span><span class="st">'educ'</span>, <span class="kw">treated.last</span><span class="kw">=</span><span class="fl">FALSE</span>)$<span class="no">W</span>)

<span class="no">default</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">rank</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">N1</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">T1</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="no">cps.baseline.params</span>  <span class="kw">=</span> <span class="fu"><a href="../reference/estimate_dgp.html">estimate_dgp</a></span>(<span class="no">Y.logwage</span>, <span class="no">w.minwage</span>, <span class="no">default</span>$<span class="no">rank</span>)</pre></body></html></div>
</div>
<div id="define-a-function-for-creating-simulators-" class="section level2">
<h2 class="hasAnchor">
<a href="#define-a-function-for-creating-simulators-" class="anchor"></a>Define a function for creating simulators.</h2>
<p>A simulator is a no-arg functions returning a simulated dataset, and
this function is used to define them by modifying an extant dgp
specification.</p>
<ul>
<li>To specify the dgp parameters, we pass in a set of baseline
parameters as estimated by estimate.dgp and a set of functions
<code>F</code>, <code>M</code>, etc. with names corresponding to those
parameters which compute the actual parameters for the simulator as
functions of the corresponding baseline parameter</li>
<li>If a numeric value of resample is passed, in each simulation
resample that number of units, i.e., rows from <code>L = M + F</code>,
to use in the simulation design. This is used in some rows of Table
4.</li>
</ul>
<p>This returns a list with two elements.</p>
<ol style="list-style-type: decimal">
<li>In the slot <code>$run</code>, the simulator, a no-args function
returning a simulated dataset.</li>
<li>In the slot <code>$params</code>, the parameters of the dgp.</li>
</ol>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">simulator</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">params</span> <span class="kw">=</span> <span class="no">cps.baseline.params</span>,
                     <span class="no">F</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">x</span>){<span class="no">x</span>}, <span class="no">M</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">x</span>){<span class="no">x</span>},
                     <span class="no">Sigma</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>){<span class="no">x</span>}, <span class="no">pi</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>){<span class="no">x</span>},
                     <span class="no">ar_coef</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>){<span class="no">x</span>},
                     <span class="no">N1</span><span class="kw">=</span><span class="no">default</span>$<span class="no">N1</span>, <span class="no">T1</span><span class="kw">=</span><span class="no">default</span>$<span class="no">T1</span>, <span class="no">resample</span><span class="kw">=</span><span class="kw">NULL</span>) {

    <span class="no">updated.params</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">F</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html">F</a></span>(<span class="no">params</span>$<span class="no">F</span>), <span class="kw">M</span><span class="kw">=</span><span class="fu">M</span>(<span class="no">params</span>$<span class="no">M</span>),
                          <span class="kw">Sigma</span><span class="kw">=</span><span class="fu">Sigma</span>(<span class="no">params</span>$<span class="no">Sigma</span>), <span class="kw">pi</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Constants.html">pi</a></span>(<span class="no">params</span>$<span class="no">pi</span>),
                          <span class="kw">ar_coef</span><span class="kw">=</span><span class="fu">ar_coef</span>(<span class="no">params</span>$<span class="no">ar_coef</span>))

    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">params</span><span class="kw">=</span><span class="no">updated.params</span>, <span class="kw">N1</span><span class="kw">=</span><span class="no">N1</span>, <span class="kw">T1</span><span class="kw">=</span><span class="no">T1</span>,
         <span class="kw">run</span><span class="kw">=</span><span class="kw">function</span>() {
             <span class="kw">if</span>(!<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span>(<span class="no">resample</span>)) {
                <span class="fu"><a href="../reference/simulate_dgp.html">simulate_dgp</a></span>(<span class="no">updated.params</span>, <span class="no">N1</span>, <span class="no">T1</span>)
             } <span class="kw">else</span> {
                <span class="no">ind</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample.int</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">updated.params</span>$<span class="no">F</span>), <span class="kw">size</span><span class="kw">=</span><span class="no">resample</span>, <span class="kw">replace</span><span class="kw">=</span><span class="fl">TRUE</span>)
                <span class="no">resampled.params</span><span class="kw">=</span><span class="no">updated.params</span>
                <span class="no">resampled.params</span>$<span class="no">F</span><span class="kw">=</span><span class="no">updated.params</span>$<span class="no">F</span>[<span class="no">ind</span>,]
                <span class="no">resampled.params</span>$<span class="no">M</span><span class="kw">=</span><span class="no">updated.params</span>$<span class="no">M</span>[<span class="no">ind</span>,]
                <span class="fu"><a href="../reference/simulate_dgp.html">simulate_dgp</a></span>(<span class="no">resampled.params</span>, <span class="no">N1</span>, <span class="no">T1</span>)
            }
        })
}</pre></body></html></div>
</div>
<div id="define-simulators-" class="section level2">
<h2 class="hasAnchor">
<a href="#define-simulators-" class="anchor"></a>Define simulators.</h2>
<ul>
<li>Simulators use <code>Sigma</code>, not <code>ar_coef</code>, to
generate noise, so updating <code>ar_coef</code> doesn’t affect the
simulations.</li>
<li>We do update <code>ar_coef</code> below so <code>$params</code> has
the correct coefficients. These will be shown in Table 2.</li>
</ul>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">simulators</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">baseline</span>   <span class="kw">=</span>  <span class="fu">simulator</span>(),
    <span class="co"># Modified outcome model</span>
    <span class="kw">no.corr</span>    <span class="kw">=</span>  <span class="fu">simulator</span>(<span class="kw">Sigma</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">Sigma</span>) { <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Sigma</span>)) * <span class="fu"><a href="https://rdrr.io/r/base/norm.html">norm</a></span>(<span class="no">Sigma</span>,<span class="st">'f'</span>)/<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">Sigma</span>))},
                            <span class="kw">ar_coef</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">coefs</span>) { <span class="fl">0</span>*<span class="no">coefs</span> }),
    <span class="kw">no.M</span>       <span class="kw">=</span>  <span class="fu">simulator</span>(<span class="kw">M</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">M</span>) { <span class="fl">0</span>*<span class="no">M</span> }),
    <span class="kw">no.F</span>       <span class="kw">=</span>  <span class="fu">simulator</span>(<span class="kw">F</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">F</span>) { <span class="fl">0</span>*<span class="no">F</span> }),
    <span class="kw">only.noise</span> <span class="kw">=</span>  <span class="fu">simulator</span>(<span class="kw">M</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">M</span>) { <span class="fl">0</span>*<span class="no">M</span> }, <span class="kw">F</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">F</span>) {<span class="fl">0</span>*<span class="no">F</span>}),
    <span class="kw">no.noise</span>   <span class="kw">=</span>  <span class="fu">simulator</span>(<span class="kw">Sigma</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">Sigma</span>) { <span class="fl">0</span>*<span class="no">Sigma</span> }, <span class="kw">ar_coef</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">coefs</span>) { <span class="fl">0</span>*<span class="no">coefs</span> }),
    <span class="co"># Modified assignment process</span>
    <span class="kw">gun.law</span>    <span class="kw">=</span>  <span class="fu">simulator</span>(<span class="fu"><a href="../reference/estimate_dgp.html">estimate_dgp</a></span>(<span class="no">Y.logwage</span>, <span class="no">w.gunlaw</span>,   <span class="no">default</span>$<span class="no">rank</span>)),
    <span class="kw">abortion</span>   <span class="kw">=</span>  <span class="fu">simulator</span>(<span class="fu"><a href="../reference/estimate_dgp.html">estimate_dgp</a></span>(<span class="no">Y.logwage</span>, <span class="no">w.abortion</span>, <span class="no">default</span>$<span class="no">rank</span>)),
    <span class="kw">random</span>     <span class="kw">=</span>  <span class="fu">simulator</span>(<span class="kw">pi</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">pi</span>) { <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">.5</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">pi</span>)) }),
    <span class="co"># Modified outcome variable</span>
    <span class="kw">hours</span>      <span class="kw">=</span>  <span class="fu">simulator</span>(<span class="fu"><a href="../reference/estimate_dgp.html">estimate_dgp</a></span>(<span class="no">Y.hours</span>,   <span class="no">w.minwage</span>,  <span class="no">default</span>$<span class="no">rank</span>)),
    <span class="kw">urate</span>      <span class="kw">=</span>  <span class="fu">simulator</span>(<span class="fu"><a href="../reference/estimate_dgp.html">estimate_dgp</a></span>(<span class="no">Y.urate</span>,   <span class="no">w.minwage</span>,  <span class="no">default</span>$<span class="no">rank</span>)),
    <span class="co"># Assignment block size</span>
    <span class="kw">T1.is.one</span>  <span class="kw">=</span> <span class="fu">simulator</span>(<span class="kw">T1</span><span class="kw">=</span><span class="fl">1</span>),
    <span class="kw">N1.is.one</span>  <span class="kw">=</span> <span class="fu">simulator</span>(<span class="kw">N1</span><span class="kw">=</span><span class="fl">1</span>),
    <span class="kw">blocksize.is.one</span> <span class="kw">=</span> <span class="fu">simulator</span>(<span class="kw">T1</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">N1</span><span class="kw">=</span><span class="fl">1</span>),
    <span class="co"># Resample rows (from Table 4)</span>
    <span class="kw">resample.200</span> <span class="kw">=</span> <span class="fu">simulator</span>(<span class="kw">resample</span><span class="kw">=</span><span class="fl">200</span>, <span class="kw">N1</span><span class="kw">=</span><span class="fl">20</span>),
    <span class="kw">resample.400</span> <span class="kw">=</span> <span class="fu">simulator</span>(<span class="kw">resample</span><span class="kw">=</span><span class="fl">400</span>, <span class="kw">N1</span><span class="kw">=</span><span class="fl">40</span>),
    <span class="co"># penn world table (Table 3)</span>
    <span class="kw">penn.democracy</span>  <span class="kw">=</span> <span class="fu">simulator</span>(<span class="fu"><a href="../reference/estimate_dgp.html">estimate_dgp</a></span>(<span class="no">Y.loggdp</span>,  <span class="no">w.democracy</span>, <span class="no">default</span>$<span class="no">rank</span>)),
    <span class="kw">penn.education</span>  <span class="kw">=</span> <span class="fu">simulator</span>(<span class="fu"><a href="../reference/estimate_dgp.html">estimate_dgp</a></span>(<span class="no">Y.loggdp</span>,  <span class="no">w.education</span>, <span class="no">default</span>$<span class="no">rank</span>)),
    <span class="kw">penn.random</span>     <span class="kw">=</span> <span class="fu">simulator</span>(<span class="fu"><a href="../reference/estimate_dgp.html">estimate_dgp</a></span>(<span class="no">Y.loggdp</span>,  <span class="no">w.education</span>, <span class="no">default</span>$<span class="no">rank</span>),
                                <span class="kw">pi</span><span class="kw">=</span><span class="kw">function</span>(<span class="no">pi</span>) { <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">.5</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">pi</span>)) }))</pre></body></html></div>
</div>
<div id="run-simulations-" class="section level2">
<h2 class="hasAnchor">
<a href="#run-simulations-" class="anchor"></a>Run simulations.</h2>
<ul>
<li>Do many point estimates, as these are fast, to estimate rmse and
bias for Tables 2 and 3.</li>
<li>Do fewer standard error estimates, as these are slow, for coverage
for Table 4.</li>
<li>Save results in simulations/simulations*.rds. Assumes the directory
simulations exists.</li>
</ul>
<div id="details" class="section level3">
<h3 class="hasAnchor">
<a href="#details" class="anchor"></a>Details</h3>
<p>This is a long-running computation, taking roughly 3 days on a recent
macbook air. It is written to save data as it runs, one file per
simulation, so it can be continued if interrupted. To continue, just
rerun the loop: only simulation for which these files are missing are
run. It can also be run on a slurm cluster, and will do so if a
correctly configured template file batchtools.slurm.tmpl is present. We
include the one we use in the paper-results-details directory.</p>
<p>The loop gives each replication of a simulation its own RNG seed.
Within each replication, every call to a simulator, estimator, or
variance estimator uses this replication-specific seed: we explicitly
restore the seed before each call. As a result, changing the set of
simulations, estimators, or variance estimators considered does not
change the results we get for any specific
simulator/estimator/variance-estimator within a given replication. Nor
does interrupting and continuing the loop.</p>
<p>By using RNGSeq to choose replication-specific seeds for the
L’Ecuyer-CMRG RNG, we get streams of random numbers that are more or
less independent from replication to replication. See
<code><a href="https://rdrr.io/pkg/rngtools/man/RNGseq.html">help(RNGseq)</a></code>.</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">sim.replications</span>  <span class="kw">=</span> <span class="fl">1000</span>
<span class="no">coverage.replications</span> <span class="kw">=</span> <span class="fl">400</span>
<span class="no">coverage.estimators</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'sdid'</span>,<span class="st">'sc'</span>, <span class="st">'did'</span>, <span class="st">'difp'</span>)
<span class="no">coverage.sims</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'baseline'</span>,  <span class="st">'gun.law'</span>, <span class="st">'abortion'</span>, <span class="st">'random'</span>, <span class="st">'hours'</span>, <span class="st">'urate'</span>,
                  <span class="st">'T1.is.one'</span>, <span class="st">'N1.is.one'</span>, <span class="st">'blocksize.is.one'</span>,
                  <span class="st">'resample.200'</span>, <span class="st">'resample.400'</span>,
                  <span class="st">'penn.democracy'</span>, <span class="st">'penn.education'</span>, <span class="st">'penn.random'</span>)
<span class="no">se.methods</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'bootstrap'</span>, <span class="st">'jackknife'</span>, <span class="st">'placebo'</span>)
<span class="no">cluster</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="st">'batchtools.slurm.tmpl'</span>)

<span class="co"># set up simulation grid</span>
<span class="no">grid</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="kw">ss</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">simulators</span>),
                   <span class="kw">ee</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">estimators</span>),
                   <span class="kw">rr</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="no">sim.replications</span>)
<span class="no">grid</span>$<span class="no">estimate.se</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">simulators</span>[<span class="no">grid</span>$<span class="no">ss</span>]) <span class="kw">%in%</span>  <span class="no">coverage.sims</span> <span class="kw">&amp;</span>
                         <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">estimators</span>[<span class="no">grid</span>$<span class="no">ee</span>]) <span class="kw">%in%</span>  <span class="no">coverage.estimators</span> <span class="kw">&amp;</span>
                         <span class="no">grid</span>$<span class="no">rr</span> <span class="kw">&lt;=</span> <span class="no">coverage.replications</span>

<span class="co"># associate a grid row to an output filename</span>
<span class="no">output.file</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">row</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">'simulations/simulation-%s-%s-%d.rds'</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">simulators</span>)[<span class="no">row</span>$<span class="no">ss</span>], <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">estimators</span>)[<span class="no">row</span>$<span class="no">ee</span>], <span class="no">row</span>$<span class="no">rr</span>)
}
<span class="no">rows.finished</span> <span class="kw">=</span> <span class="kw">function</span>() {
    <span class="no">output.files</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">grid</span>), <span class="kw">function</span>(<span class="no">ii</span>) { <span class="fu">output.file</span>(<span class="no">grid</span>[<span class="no">ii</span>,]) })
    <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span>(<span class="no">output.files</span>)
}</pre></body></html></div>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="co"># set up RNG seeds for each replication.</span>
<span class="co"># We need to pass a L'Ecuyer-type seed: a vector of 7 integers starting with 10407 like initial.seed below.</span>
<span class="co"># If we pass a simple integer seed, the first call in a vanilla R session (R --vanilla) differs from subsequent ones.</span>
<span class="co"># To get initial_seed I run: 'library(rngtools); ignore=RNGseq(n=1, seed=12345); initial.seed=RNGseq(n=1,seed=12345)'.</span>
<span class="no">initial.seed</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10407</span>, -<span class="fl">2132566924</span>,  <span class="fl">1638542565</span>, <span class="fl">108172386</span>, -<span class="fl">1884566405</span>, -<span class="fl">1838154368</span>, -<span class="fl">250773631</span>)
<span class="no">seeds</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rngtools/man/RNGseq.html">RNGseq</a></span>(<span class="kw">n</span><span class="kw">=</span><span class="no">sim.replications</span>, <span class="kw">seed</span><span class="kw">=</span><span class="no">initial.seed</span>)</pre></body></html></div>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="no">run.simulation</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">row</span>) {
    <span class="fu"><a href="https://rdrr.io/pkg/rngtools/man/rng.html">setRNG</a></span>(<span class="no">seeds</span><span class="kw">[[</span><span class="no">row</span>$<span class="no">rr</span>]])
    <span class="no">setup</span> <span class="kw">=</span> <span class="no">simulators</span><span class="kw">[[</span><span class="no">row</span>$<span class="no">ss</span>]]$<span class="fu"><a href="https://future.futureverse.org/reference/run.html">run</a></span>()
    <span class="no">estimate</span> <span class="kw">=</span> <span class="no">estimators</span><span class="kw">[[</span><span class="no">row</span>$<span class="no">ee</span>]](<span class="no">setup</span>$<span class="no">Y</span>, <span class="no">setup</span>$<span class="no">N0</span>, <span class="no">setup</span>$<span class="no">T0</span>)
    <span class="no">se.estimates</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">se.methods</span>, <span class="kw">function</span>(<span class="no">method</span>) {
        <span class="fu"><a href="https://rdrr.io/pkg/rngtools/man/rng.html">setRNG</a></span>(<span class="no">seeds</span><span class="kw">[[</span><span class="no">row</span>$<span class="no">rr</span>]])
        <span class="kw">if</span>(<span class="no">row</span>$<span class="no">estimate.se</span>) { <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span>(<span class="no">estimate</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="no">method</span>)) } <span class="kw">else</span> { <span class="fl">NA</span> }
    })
    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">simulation</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">simulators</span>)[<span class="no">row</span>$<span class="no">ss</span>],
                     <span class="kw">estimator</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">estimators</span>)[<span class="no">row</span>$<span class="no">ee</span>],
                     <span class="kw">replication</span> <span class="kw">=</span> <span class="no">row</span>$<span class="no">rr</span>,
                     <span class="kw">estimate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">estimate</span>)),
          <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">se.estimates</span>)))
}</pre></body></html></div>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="co"># kill warning that the futures library can't determine that we're</span>
<span class="co"># using and deterministically seeding the L'Ecuyer RNG</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="st">'future.options.rng.onMisuse'</span>, <span class="st">'ignore'</span>)</pre></body></html></div>
<pre><code>## $future.options.rng.onMisuse
## NULL
## 
## $ignore
## NULL</code></pre>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/doFuture/man/registerDoFuture.html">registerDoFuture</a></span>()

<span class="co"># set up worker processes</span>
<span class="kw">if</span>(<span class="no">cluster</span>) {
    <span class="co"># use multiple nodes on a Slurm Cluster</span>
    <span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span>(<span class="no">batchtools_slurm</span>, <span class="kw">workers</span><span class="kw">=</span><span class="fl">1000</span>, <span class="kw">resources</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">ncpus</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">memory</span><span class="kw">=</span><span class="fl">1024</span>))
} <span class="kw">else</span> {
    <span class="co"># use multiple processes on this this computer</span>
    <span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span>(<span class="no">multisession</span>, <span class="kw">workers</span> <span class="kw">=</span> <span class="fl">8</span>)
}</pre></body></html></div>
</div>
</div>
<div id="load-output-from-disk-and-concatenate-into-a-data-frame" class="section level2">
<h2 class="hasAnchor">
<a href="#load-output-from-disk-and-concatenate-into-a-data-frame" class="anchor"></a>Load output from disk and concatenate into a data frame</h2>
<div class="sourceCode" id="cb41"><html><body><pre class="r"># uncomment to run sims
# estimates = foreach(ii = which(rows.finished()), .combine=rbind) %do% {
#   readRDS(output.file(grid[ii,]))
# }
# estimates$simulation = factor(estimates$simulation,  levels=names(simulators))
# estimates$estimator  = factor(estimates$estimator,   levels=names(estimators))</pre></body></html></div>
<p>To share data, check that simulations are complete and save
concatenated data frame as one file.</p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"># uncomment to run sims
# stopifnot(all(rows.finished()))
# saveRDS(estimates, 'all-simulations.rds')</pre></body></html></div>
<p>To use shared data, load concatenated data frame from file.</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">estimates</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="st">'all-simulations.rds'</span>)</pre></body></html></div>
</div>
<div id="compute-summary-statistics-from-simulations" class="section level2">
<h2 class="hasAnchor">
<a href="#compute-summary-statistics-from-simulations" class="anchor"></a>Compute summary statistics from simulations</h2>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="no">summaries</span> <span class="kw">=</span> <span class="no">estimates</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">simulation</span>, <span class="no">estimator</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">rmse</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">estimate</span>^<span class="fl">2</span>)),
                  <span class="kw">bias</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">estimate</span>),
                  <span class="kw">bootstrap.coverage</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">estimate</span>/<span class="no">bootstrap</span>) <span class="kw">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="fl">.975</span>), <span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>),
                  <span class="kw">jackknife.coverage</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">estimate</span>/<span class="no">jackknife</span>) <span class="kw">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="fl">.975</span>), <span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>),
                  <span class="kw">placebo.coverage</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">estimate</span>/<span class="no">placebo</span>) <span class="kw">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span>(<span class="fl">.975</span>),   <span class="kw">na.rm</span><span class="kw">=</span><span class="fl">TRUE</span>),
                  <span class="kw">coverage.count</span>     <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(!(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">placebo</span>) <span class="kw">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">bootstrap</span>) <span class="kw">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">jackknife</span>))))</pre></body></html></div>
<pre><code>## `summarise()` has grouped output by 'simulation'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="no">point.columns</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'rmse'</span>, <span class="st">'bias'</span>)
<span class="no">coverage.columns</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'bootstrap.coverage'</span>, <span class="st">'jackknife.coverage'</span>, <span class="st">'placebo.coverage'</span>)</pre></body></html></div>
<p>Our standard error estimators can be undefined in some instances,
returning NA. This happens to the bootstrap and jacknife if there is
only one treated unit and to the jackknife if there is only one control
with nonzero weight. As we see in the table below, this happens in one
replication of the urate simulation. We compute coverage over the
replications for which each standard error estimator is defined passing
na.rm=TRUE to mean above.</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="no">summaries</span>[!(<span class="no">summaries</span>$<span class="no">coverage.count</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">coverage.replications</span>)),
           <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'simulation'</span>, <span class="st">'estimator'</span>, <span class="st">'coverage.count'</span>)]</pre></body></html></div>
<pre><code>## # A tibble: 0 × 3
## # Groups:   simulation [0]
## # … with 3 variables: simulation &lt;fct&gt;, estimator &lt;fct&gt;, coverage.count &lt;int&gt;</code></pre>
</div>
<div id="point-estimation-tables-2-and-3" class="section level2">
<h2 class="hasAnchor">
<a href="#point-estimation-tables-2-and-3" class="anchor"></a>Point Estimation: Tables 2 and 3</h2>
<div id="compute-summary-info-about-simulator-designs-to-include-in-table-2-" class="section level3">
<h3 class="hasAnchor">
<a href="#compute-summary-info-about-simulator-designs-to-include-in-table-2-" class="anchor"></a>Compute summary info about simulator designs to include in Table
2.</h3>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="no">sim.info</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">simulators</span>, <span class="kw">function</span>(<span class="no">sim</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">F_scale</span>  <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">sim</span>$<span class="no">params</span>$<span class="no">F</span>^<span class="fl">2</span>)),
               <span class="kw">M_scale</span>  <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">sim</span>$<span class="no">params</span>$<span class="no">M</span>^<span class="fl">2</span>)),
               <span class="kw">noise_scale</span>  <span class="kw">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">sim</span>$<span class="no">params</span>$<span class="no">Sigma</span>))),
               <span class="kw">ar_lag1</span>      <span class="kw">=</span>  <span class="no">sim</span>$<span class="no">params</span>$<span class="no">ar_coef</span>[<span class="fl">1</span>],
               <span class="kw">ar_lag2</span>      <span class="kw">=</span>  <span class="no">sim</span>$<span class="no">params</span>$<span class="no">ar_coef</span>[<span class="fl">2</span>])
}))</pre></body></html></div>
</div>
</div>
<div id="display-a-point-estimate-summary-table" class="section level2">
<h2 class="hasAnchor">
<a href="#display-a-point-estimate-summary-table" class="anchor"></a>Display a point estimate summary table</h2>
<p>In the paper, this is split into Tables 2 and 3, with CPS sims in the
former and PENN sims in the latter.</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="no">point.summaries</span> <span class="kw">=</span> <span class="no">summaries</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'simulation'</span>, <span class="st">'estimator'</span>, <span class="no">point.columns</span>)] <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(<span class="kw">names_from</span><span class="kw">=</span><span class="no">estimator</span>, <span class="kw">values_from</span><span class="kw">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">all_of</a></span>(<span class="no">point.columns</span>)) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span>(<span class="st">'simulation'</span>)
<span class="no">point.table</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">sim.info</span>, <span class="no">point.summaries</span>)

<span class="co"># display table, leaving out non-default regularization choices</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">point.table</span>, <span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)[, -<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">18</span>,<span class="fl">19</span>)]</pre></body></html></div>
<pre><code>##                  F_scale M_scale noise_scale ar_lag1 ar_lag2 rmse_did rmse_sc rmse_sdid rmse_difp rmse_mc bias_did bias_sc bias_sdid bias_difp bias_mc
## baseline           0.992   0.100       0.098    0.01   -0.06    0.049   0.037     0.028     0.032   0.035    0.021   0.020     0.010     0.007   0.015
## no.corr            0.992   0.100       0.098    0.00    0.00    0.049   0.038     0.028     0.032   0.035    0.021   0.020     0.010     0.007   0.015
## no.M               0.992   0.000       0.098    0.01   -0.06    0.014   0.018     0.016     0.016   0.014    0.001   0.004     0.001     0.001   0.001
## no.F               0.000   0.100       0.098    0.01   -0.06    0.049   0.023     0.028     0.032   0.035    0.021   0.004     0.010     0.007   0.015
## only.noise         0.000   0.000       0.098    0.01   -0.06    0.014   0.014     0.016     0.016   0.014    0.001   0.001     0.001     0.001   0.001
## no.noise           0.992   0.100       0.000    0.00    0.00    0.047   0.017     0.006     0.011   0.004    0.020   0.004     0.004     0.001   0.000
## gun.law            0.992   0.100       0.098    0.01   -0.06    0.047   0.027     0.026     0.030   0.035    0.015  -0.003     0.008     0.009   0.015
## abortion           0.992   0.100       0.098    0.01   -0.06    0.045   0.031     0.023     0.027   0.031    0.003   0.016     0.004     0.001   0.003
## random             0.992   0.100       0.098    0.01   -0.06    0.044   0.025     0.024     0.027   0.031    0.002  -0.001     0.001     0.000   0.001
## hours              0.789   0.402       0.575    0.06    0.00    0.206   0.203     0.190     0.197   0.185    0.085  -0.049     0.111     0.099   0.100
## urate              0.752   0.441       0.593   -0.02   -0.01    0.353   0.184     0.191     0.187   0.247    0.304   0.080     0.100     0.078   0.187
## T1.is.one          0.992   0.100       0.098    0.01   -0.06    0.070   0.059     0.050     0.054   0.051    0.038   0.017     0.019     0.012   0.021
## N1.is.one          0.992   0.100       0.098    0.01   -0.06    0.126   0.072     0.063     0.083   0.081    0.011   0.014     0.002    -0.002   0.004
## blocksize.is.one   0.992   0.100       0.098    0.01   -0.06    0.153   0.124     0.112     0.117   0.108    0.033   0.024     0.014     0.011   0.016
## resample.200       0.992   0.100       0.098    0.01   -0.06    0.029   0.017     0.015     0.018   0.018   -0.001  -0.002     0.000     0.000  -0.001
## resample.400       0.992   0.100       0.098    0.01   -0.06    0.020   0.014     0.010     0.015   0.013   -0.001  -0.004     0.000     0.000   0.000
## penn.democracy     0.972   0.229       0.070    0.91   -0.22    0.197   0.038     0.031     0.039   0.058    0.175  -0.004    -0.005    -0.007   0.043
## penn.education     0.972   0.229       0.070    0.91   -0.22    0.172   0.053     0.030     0.039   0.049    0.162   0.025    -0.003    -0.005   0.040
## penn.random        0.972   0.229       0.070    0.91   -0.22    0.129   0.046     0.037     0.045   0.063   -0.006  -0.011    -0.002    -0.004  -0.004</code></pre>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="co"># display table comparing default and non-default regularization choices</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">point.table</span>, <span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7</span>,<span class="fl">11</span>,<span class="fl">9</span>,<span class="fl">12</span>)]</pre></body></html></div>
<pre><code>##                  rmse_sc rmse_sc_reg rmse_difp rmse_difp_reg
## baseline           0.037       0.078     0.032         0.036
## no.corr            0.038       0.079     0.032         0.036
## no.M               0.018       0.034     0.016         0.014
## no.F               0.023       0.025     0.032         0.036
## only.noise         0.014       0.012     0.016         0.014
## no.noise           0.017       0.034     0.011         0.020
## gun.law            0.027       0.034     0.030         0.040
## abortion           0.031       0.065     0.027         0.035
## random             0.025       0.031     0.027         0.035
## hours              0.203       0.329     0.197         0.191
## urate              0.184       0.259     0.187         0.288
## T1.is.one          0.059       0.065     0.054         0.050
## N1.is.one          0.072       0.085     0.083         0.087
## blocksize.is.one   0.124       0.124     0.117         0.112
## resample.200       0.017       0.016     0.018         0.018
## resample.400       0.014       0.011     0.015         0.012
## penn.democracy     0.038       0.035     0.039         0.031
## penn.education     0.053       0.062     0.039         0.029
## penn.random        0.046       0.047     0.045         0.046</code></pre>
</div>
<div id="display-a-coverage-summary-table-" class="section level2">
<h2 class="hasAnchor">
<a href="#display-a-coverage-summary-table-" class="anchor"></a>Display a coverage summary table.</h2>
<p>A subset of these rows are in Table 4 of the paper.</p>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="no">coverage.table</span> <span class="kw">=</span> <span class="no">summaries</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'simulation'</span>, <span class="st">'estimator'</span>, <span class="no">coverage.columns</span>)] <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(<span class="kw">names_from</span><span class="kw">=</span><span class="no">estimator</span>, <span class="kw">values_from</span><span class="kw">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">all_of</a></span>(<span class="no">coverage.columns</span>)) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">column_to_rownames</a></span>(<span class="st">'simulation'</span>)
<span class="no">keep</span> <span class="kw">=</span> !<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">coverage.table</span>[<span class="fl">1</span>,])

<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">coverage.table</span>[<span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span>(<span class="no">coverage.table</span>) <span class="kw">%in%</span> <span class="no">coverage.sims</span>, <span class="no">keep</span>], <span class="kw">digits</span><span class="kw">=</span><span class="fl">2</span>)</pre></body></html></div>
<pre><code>##                  bootstrap.coverage_did bootstrap.coverage_sc bootstrap.coverage_sdid bootstrap.coverage_difp jackknife.coverage_did jackknife.coverage_sc jackknife.coverage_sdid jackknife.coverage_difp placebo.coverage_did placebo.coverage_sc placebo.coverage_sdid placebo.coverage_difp
## baseline                           0.89                  0.93                    0.96                    0.94                   0.92                  0.95                    0.96                    0.97                 0.96                0.88                  0.95                  0.94
## gun.law                            0.92                  0.96                    0.97                    0.96                   0.93                  0.99                    0.97                    0.99                 0.93                0.95                  0.94                  0.94
## abortion                           0.93                  0.94                    0.96                    0.97                   0.95                  0.97                    0.96                    0.99                 0.96                0.91                  0.97                  0.96
## random                             0.92                  0.96                    0.96                    0.95                   0.94                  0.98                    0.97                    0.98                 0.94                0.96                  0.96                  0.96
## hours                              0.94                  0.96                    0.92                    0.92                   0.95                  0.98                    0.94                    0.97                 0.96                0.89                  0.91                  0.93
## urate                              0.58                  0.90                    0.91                    0.91                   0.64                  0.96                    0.92                    0.96                 0.62                0.88                  0.88                  0.89
## T1.is.one                          0.84                  0.94                    0.93                    0.91                   0.88                  0.97                    0.95                    0.97                 0.92                0.90                  0.92                  0.92
## N1.is.one                           NaN                   NaN                     NaN                     NaN                    NaN                   NaN                     NaN                     NaN                 0.96                0.95                  0.97                  0.96
## blocksize.is.one                    NaN                   NaN                     NaN                     NaN                    NaN                   NaN                     NaN                     NaN                 0.94                0.94                  0.95                  0.94
## resample.200                       0.92                  0.96                    0.94                    0.96                   0.93                  1.00                    0.95                    1.00                 0.94                0.94                  0.96                  0.94
## resample.400                       0.96                  0.92                    0.95                    0.94                   0.95                  1.00                    0.95                    1.00                 0.96                0.90                  0.96                  0.93
## penn.democracy                     0.55                  0.96                    0.93                    0.96                   0.59                  0.99                    0.95                    0.99                 0.79                0.97                  0.98                  0.96
## penn.education                     0.30                  0.95                    0.95                    0.95                   0.34                  0.96                    0.97                    1.00                 0.94                0.90                  0.99                  0.96
## penn.random                        0.89                  0.95                    0.93                    0.96                   0.91                  0.99                    0.94                    1.00                 0.91                0.94                  0.95                  0.95</code></pre>
</div>
<div id="plot-the-error-distribution-of-the-estimates-figure-2" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-the-error-distribution-of-the-estimates-figure-2" class="anchor"></a>Plot the error distribution of the estimates (Figure 2)</h2>
<p>We plot an estimate of error density function for the baseline CPS
setting and the minimum wage assignment variant. This is Figure 2.</p>
<div class="sourceCode" id="cb56"><html><body><pre class="r"><span class="no">grid</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="kw">ss</span><span class="kw">=</span><span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">simulators</span>), <span class="kw">ee</span><span class="kw">=</span><span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">estimators</span>))
<span class="no">error.densities</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span>(<span class="kw">function</span>(<span class="no">ss</span>,<span class="no">ee</span>) {
    <span class="no">errors</span> <span class="kw">=</span> <span class="no">estimates</span>[<span class="no">estimates</span>$<span class="no">simulation</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">simulators</span>)[<span class="no">ss</span>] <span class="kw">&amp;</span>
                       <span class="no">estimates</span>$<span class="no">estimator</span>  <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">estimators</span>)[<span class="no">ee</span>], <span class="st">'estimate'</span>]
    <span class="no">density.estimate</span> <span class="kw">=</span> <span class="fu"><a href="../reference/lindsey_density_estimate.html">lindsey_density_estimate</a></span>(<span class="no">errors</span>, <span class="kw">K</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">deg</span> <span class="kw">=</span> <span class="fl">3</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">density.estimate</span>$<span class="no">centers</span>,
               <span class="kw">y</span><span class="kw">=</span><span class="no">density.estimate</span>$<span class="no">density</span>,
               <span class="kw">simulator</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">simulators</span>)[<span class="no">ss</span>],
               <span class="kw">estimator</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">estimators</span>)[<span class="no">ee</span>])
    }, <span class="no">grid</span>$<span class="no">ss</span>, <span class="no">grid</span>$<span class="no">ee</span>, <span class="kw">SIMPLIFY</span><span class="kw">=</span><span class="fl">FALSE</span>))</pre></body></html></div>
<pre><code>## Warning: glm.fit: fitted rates numerically 0 occurred

## Warning: glm.fit: fitted rates numerically 0 occurred</code></pre>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">show.sims</span>       <span class="kw">=</span> <span class="no">error.densities</span>$<span class="no">simulator</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'baseline'</span>, <span class="st">'random'</span>)
<span class="no">show.estimators</span> <span class="kw">=</span> <span class="no">error.densities</span>$<span class="no">estimator</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'did'</span>, <span class="st">'sc'</span>, <span class="st">'sdid'</span>)
<span class="co"># reformat the information in $simulator and $estimator for display in the plot title and legend</span>
<span class="no">error.densities</span>$<span class="no">Title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">error.densities</span>$<span class="no">simulator</span> <span class="kw">==</span> <span class="st">'baseline'</span>,
                               <span class="st">'Minimum Wage Assignment'</span>, <span class="st">'Random Assignment'</span>)
<span class="no">error.densities</span>$<span class="no">Estimator</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span>(<span class="no">error.densities</span>$<span class="no">estimator</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">error.densities</span>[<span class="no">show.sims</span> <span class="kw">&amp;</span> <span class="no">show.estimators</span>, ]) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">x</span>,<span class="kw">y</span><span class="kw">=</span><span class="no">y</span>,<span class="kw">color</span><span class="kw">=</span><span class="no">Estimator</span>)) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="kw">xintercept</span><span class="kw">=</span><span class="fl">0</span>, <span class="kw">linetype</span><span class="kw">=</span><span class="fl">3</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">Title</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">'error'</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">'density'</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.94</span>,<span class="fl">.88</span>),
                          <span class="kw">legend.background</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>(),
                          <span class="kw">legend.title</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>())</pre></body></html></div>
<p><img src="figures/error-density-plot-1.png" width="768"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David A. Hirshberg.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
